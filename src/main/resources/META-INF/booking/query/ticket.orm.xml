<?xml version="1.0" encoding="UTF-8" ?>
<entity-mappings xmlns="https://jakarta.ee/xml/ns/persistence/orm" version="3.2">
  <named-native-query name="TicketDetailView.getTicket" result-set-mapping="TicketDetailView">
    <query>
      <![CDATA[
        SELECT
          t.ticket_id,
          t.status,
          tb.booking_id AS booking_id,
          tb.status AS booking_status,
          t.seat_assignment_movie_title,
          t.seat_assignment_hall_name,
          t.seat_assignment_scheduled_at,
          t.seat_assignment_seat_number
        FROM
          ticket AS t
        INNER JOIN
          booking AS tb ON tb.booking_id = t.booking_id
        WHERE
          t.ticket_id = :ticket_id
      ]]>
    </query>
  </named-native-query>
  <named-native-query name="TicketSummaryView.listTickets" result-set-mapping="TicketSummaryView">
    <query>
      <![CDATA[
        SELECT
          t.ticket_id,
          t.status,
          tb.booking_id AS booking_id,
          tb.status AS booking_status,
          t.seat_assignment_movie_title,
          t.seat_assignment_hall_name,
          t.seat_assignment_scheduled_at,
          t.seat_assignment_seat_number
        FROM
          ticket AS t
        INNER JOIN
          booking AS tb ON tb.booking_id = t.booking_id
        ORDER BY
          t.id_ ASC
        LIMIT
          :limit
        OFFSET
          :offset
      ]]>
    </query>
  </named-native-query>
  <sql-result-set-mapping name="TicketDetailView">
    <constructor-result target-class="com.github.booking.application.ticket.query.TicketDetailView">
      <column name="ticket_id"/>
      <column name="status"/>
      <column name="booking_id"/>
      <column name="booking_status"/>
      <column name="seat_assignment_movie_title"/>
      <column name="seat_assignment_hall_name"/>
      <column name="seat_assignment_scheduled_at" class="java.time.Instant"/>
      <column name="seat_assignment_seat_number"/>
    </constructor-result>
  </sql-result-set-mapping>
  <sql-result-set-mapping name="TicketSummaryView">
    <constructor-result target-class="com.github.booking.application.ticket.query.TicketSummaryView">
      <column name="ticket_id"/>
      <column name="status"/>
      <column name="booking_id"/>
      <column name="booking_status"/>
      <column name="seat_assignment_movie_title"/>
      <column name="seat_assignment_hall_name"/>
      <column name="seat_assignment_scheduled_at" class="java.time.Instant"/>
      <column name="seat_assignment_seat_number"/>
    </constructor-result>
  </sql-result-set-mapping>
</entity-mappings>
